<!DOCTYPE html>
<html>
<head>
    <title>Cool registration</title>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <header>
        <nav>
            <a href="index.html">Main page</a> |
            <a href="reg.html">Registration</a> |
            <a href="about.html">About</a>
        </nav>
    </header>

    <h2>Cool registration form</h2>
    
    <form id="feedback-form">
        <div>
            <label for="firstName">First name:</label>
            <input type="text" id="firstName" name="firstName" required>
        </div>
        
        <div>
            <label for="lastName">Last name:</label>
            <input type="text" id="lastName" name="lastName" required>
        </div>
        
        <div>
            <label for="email">EMail:</label>
            <input type="email" id="email" name="email" required>
        </div>
        
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        
        <div>
            <label for="confirmPassword">Confirm password:</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required>
        </div>

        <div>
            <label for="birthDate">Date of Birth:</label>
            <input type="date" id="birthDate" name="birthDate" required>
        </div>

        <div>
            <label for="country">Country:</label>
            <select id="country" name="country" required>
                <option value="">Select your country</option>
                <option value="Belarus">Belarus</option>
                <option value="Russia">Russia</option>
                <option value="USA">USA</option>
                <option value="Canada">Canada</option>
                <option value="UK">UK</option>
                <option value="Germany">Germany</option>
                <option value="France">France</option>
                <option value="Other">Other</option>
            </select>
        </div>
            
        <div class="radio-group">
            <p>Where to save your data:</p>

            <div class="radio-option">
                <input type="radio" id="saveMongo" name="saveOption" value="mongodb" checked> <!-- Добавил 'checked', чтобы было выбрано по умолчанию -->
                <label for="saveMongo">Save using MongoDB</label>
            </div>
        </div>

        <div>
            <button type="submit">Submit</button>
        </div>

        <p id="response-message" style="text-align: center; margin-top: 1rem;"></p>
    </form>


    <footer>
        <p>&copy; Our cool site. We know our rights.</p>
        <p>Contact cool devs: psoup.studio@gmail.com</p>
    </footer>

    <script>
        const myForm = document.getElementById('feedback-form');
        const responseMsg = document.getElementById('response-message');

        myForm.addEventListener('submit', async (event) => {
            // event.preventDefault() нужно вызывать в любом случае, чтобы управлять отправкой
            event.preventDefault(); 

            const saveOptionRadio = document.querySelector('input[name="saveOption"]:checked');
            
            // Проверка, выбрана ли вообще какая-либо опция
            if (!saveOptionRadio) {
                responseMsg.textContent = 'Please select a save option.';
                responseMsg.style.color = 'salmon';
                return; // Прерываем выполнение
            }

            const saveOption = saveOptionRadio.value;
            
            if (saveOption === 'mongodb') {
                const formData = new FormData(myForm);
                const data = Object.fromEntries(formData.entries());

                try {
                    const response = await fetch('/submit-to-mongo', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();
                    responseMsg.textContent = result.message;

                    if (result.success) {
                        responseMsg.style.color = 'lightgreen';
                        // Через 1.5 секунды перенаправляем на success.html
                        setTimeout(() => {
                            window.location.href = 'success.html';
                        }, 1500); 
                    } else {
                        responseMsg.style.color = 'salmon';
                    }
                } catch (error) {
                    responseMsg.textContent = 'Ошибка отправки на сервер.';
                    responseMsg.style.color = 'salmon';
                }
            } else {
                // Если выбрана не MongoDB, можно либо ничего не делать,
                // либо вызвать старую логику, если она есть.
                // Сейчас просто скажем, что эта опция не реализована.
                console.log('Другая опция сохранения, наш скрипт ее не обрабатывает.');
                // Если у друга был старый script.js, он должен был бы сработать здесь.
                // Но для чистоты эксперимента, лучше оставить так.
            }
        });
    </script>
</body>
</html>